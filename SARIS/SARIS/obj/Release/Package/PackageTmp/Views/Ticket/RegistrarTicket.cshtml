
<style>


    .img-container {
        width: 100%;
        height: 220px;
        background-image: repeating-linear-gradient(45deg,#ccc,#ccc 10px, #dbdbdb 10px, #dbdbdb 20px);
        text-align: center;
    }

        .img-container::before {
            content: "\f03e";
            font-family: "Font Awesome 5 Pro";
            font-size: 150px;
            opacity: 0.3;
        }
</style>

<div class="modal-header bg-primary-600 bg-primary-gradient" >
    <h2 class="modal-title text-white">
        
        <text>Crear Ticket</text>    
    
    </h2>
    
    <button type="button" class="close" data-dismiss="modal">
        <i class="fal fa-times-circle fa-fw fa-lg"></i>
    </button>
</div>

<div class="modal-body">
    <div class="row">

        <div class="col-lg-6">
            <div class="row">
                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="col-form-label">Titulo</label>
                        <input id="txtNombreTitulo" class="form-control" type="text" placeholder="Definicion del titulo" />
                    </div>
                </div>

                <div class="col-sm-12">
                    <div class="form-group">
                        <label class="col-form-label">Descripcion</label>
                        <input id="txtdescripcion" class="form-control" type="text" placeholder="Definicion del ticket" />
                    </div>
                </div>
                <!--<div class="col-sm-12">-->
                    <!--esto debe de ser un select -->
                    <!--<div class="form-group">
                    <label class="col-form-label">Area</label>
                    <input id="txtNombreTitulo" class="form-control" type="text" placeholder="Defina un Area" />
                        </div>
                    </div>-->

                <div class="col-lg-12">
                    <!--esto debe de ser un select -->
                    <div class="form-group">
                        <label class="col-form-label">Tipo Incidencia</label>
                        <input id="txtNombreTitulo" class="form-control" type="text" placeholder="Defina un Tipo Incidencia" />
                    </div>
                </div>

            </div>
        </div>


        <div class="col-lg-6">
            <div class="row">
                <div class="col-lg-12">
                    <div class="form-group">
                        <label class="control-label">DOCUMENTO (Solo se pueden subir pdf e imagenes) </label>

                        <form id="Imagen-dropzone" action="@Url.Action("FormFileResponse","Base")" method="post" enctype="multipart/form-data" class="dropzone needsclick">
                            <div class="dz-message needsclick">

                                <div class="dz-icon">
                                    <i class="fal fa-cloud-upload text-muted mb-3"></i>
                                </div>
                                <div>
                                    <span class="dz-text">Arrastre Imagen</span>
                                    <p class="text-sm text-muted">O Click para elegirla manualmente</p>
                                </div>
                            </div>
                        </form>


                    </div>

                </div>
            </div>
        </div>

    </div>

    <div class="row">
        <!--<div class="col-lg-6">-->
            <!--esto debe de ser un select -->
            <!--<div class="form-group">

                <label class="col-form-label">Estado</label>
                <input id="txtNombreTitulo" class="form-control" type="text" placeholder="Defina un Estado" />
            </div>
        </div>-->

        
    </div>

    <div class='test col-sm-12'>
        <br />
        <div style='float: right;'>
            <button type="button" id="btnGuardarRequerimientoEnviar" class="btn btn-success">
                Guardar Ticket
            </button>
        </div>
    </div>
</div>

<script>
    function GuardarDocumentos(IdRequerimiento) {
        for (let selectedFile of selectedFiles) {
            const form = new FormData();
            form.append("idRequerimiento", IdRequerimiento);
            form.append("idDocumento", 1);
            form.append("imagen", selectedFile);
            form.append("idUsuario", ID_USUARIO);
            form.append("idSesion", ID_SESION);
            form.append("idApp", ID_IDAPP);
            $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "/Handlers/UploadRequerimiento/UploadHandler.ashx",
                data: form,
                processData: false,
                contentType: false,
                cache: false,
                timeout: 800000,
                success: function (data) {
                    $("#modalGuardarDocumentosAsignados").modal('hide');
                    /*  console.log("ok");*/
                    $('#fileList').empty();
                    MensajeExito("Se ha guardado las imagenes Correctamente");

                    location.reload();

                },
                error: function (e) {
                    MensajeError("Error al subir imagen");
                    console.error(e);

                }
            });

        }
    }



    function GuardarRequermiento(id) {
        debugger;
        var EstadoRequerimiento = id;

        var ticket = {
            fiIDEstadoRequerimiento: EstadoRequerimiento,
            fcTituloRequerimiento: $("#txtNombreTitulo").val(),
            fcDescripcionRequerimiento: $("#txtdescripcion").val(),

            //fiIDAreaSolicitante: $("#dllDepartamentoArea :selected").val() == '' ? 0 : $("#dllDepartamentoArea :selected").val(),
            //fcDescripcionAreaSolicitante: $("#dllDepartamentoArea").text(),
        }

        $.ajax({
            type: "POST",
            url: "@Url.Action("GuardarTicket", "Ticket")",
            data: { ticket: ticket },
            error: function (xhr, ajaxOptions, thrownError) {
                MensajeError('No se guardó el registro, contacte al administrador');
            },
            success: function (data) {
                console.log(data);
                if (data.Estado) {

                }
                CerrarModal();

                //let resultado = data.d;
                //console.log(resultado);
                //if (resultado.ResultadoExitoso == true) {
                //    IdRequerimiento = resultado.DebugString;
                //    GuardarDocumentos(IdRequerimiento);
                //    window.location = "BandejaRequerimientoDesarrollo.aspx?" + window.location.href.split('?')[1];
                //}
                //else {
                //    MensajeError(resultado.MensajeResultado);
                //    console.log(resultado.DebugString);
                //}
            }
        });

    }

    $("#btnGuardarRequerimientoEnviar").click(function (e) {
        GuardarRequermiento(1);
    });


</script>
